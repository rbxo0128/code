name: Manual Blog Post

on:
  # ğŸ”¥ ìˆ˜ë™ ì‹¤í–‰ (GitHub UIì—ì„œ ì‹¤í–‰ ê°€ëŠ¥)
  workflow_dispatch:
    inputs:
      problem_path:
        description: 'ë¬¸ì œ ê²½ë¡œ (ì˜ˆ: ë°±ì¤€/Gold/1027. ê³ ì¸µ ê±´ë¬¼)'
        required: true
        type: string
      post_immediately:
        description: 'ì¦‰ì‹œ í¬ìŠ¤íŒ… (ì²´í¬ í•´ì œ ì‹œ ë¯¸ë¦¬ë³´ê¸°ë§Œ)'
        required: false
        type: boolean
        default: true

jobs:
  post-to-blog:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Validate problem path
        id: validate
        run: |
          PROBLEM_PATH="${{ github.event.inputs.problem_path }}"
          README_FILE="${PROBLEM_PATH}/README.md"
          
          if [ ! -f "$README_FILE" ]; then
            echo "âŒ README.md not found: $README_FILE"
            exit 1
          fi
          
          echo "âœ… README.md found: $README_FILE"
          echo "problem_path=$PROBLEM_PATH" >> $GITHUB_OUTPUT
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install requests
      
      - name: Preview problem info
        run: |
          python .github/scripts/preview_problem.py "${{ steps.validate.outputs.problem_path }}"
      
      - name: Post to blog
        if: github.event.inputs.post_immediately == 'true'
        env:
          BLOG_API_URL: ${{ secrets.BLOG_API_URL }}
          BLOG_API_KEY: ${{ secrets.BLOG_API_KEY }}
          PROBLEM_PATH: ${{ steps.validate.outputs.problem_path }}
        run: |
          python .github/scripts/post_single_problem.py
      
      - name: Show preview only
        if: github.event.inputs.post_immediately != 'true'
        run: |
          echo "ğŸ“‹ ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ: í¬ìŠ¤íŒ…í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
          echo "ğŸ’¡ 'ì¦‰ì‹œ í¬ìŠ¤íŒ…'ì„ ì²´í¬í•˜ê³  ë‹¤ì‹œ ì‹¤í–‰í•˜ì„¸ìš”."